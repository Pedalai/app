var APP=APP||{};APP.Switch={setUp:function(){this.listening(),this.removeAlone()},initialize:function(){$("#switch").bootstrapSwitch(),APP.Switch.listening()},listening:function(){var aloneId,groupId,rideType;aloneId=document.querySelector("#btn-alone").id,groupId=document.querySelector("#btn-group").id,rideType=document.querySelector("#ride-type"),$("#switch-choose").on("click","button",function(){if(this.id===aloneId){var name="sozinho";APP.Switch.removeAlone(),APP.Switch.changeType(name)}else if(this.id===groupId){var name="em grupo";APP.Switch.removeGroup(),APP.Switch.changeType(name)}})},changeType:function(name){var rideType;rideType=document.querySelector("#ride-type"),rideType.innerHTML=name},removeAlone:function(){var alone,group;alone=document.querySelector("#btn-alone"),group=document.querySelector("#btn-group"),alone.classList.remove("off"),group.classList.add("off")},removeGroup:function(){var alone,group;alone=document.querySelector("#btn-alone"),group=document.querySelector("#btn-group"),group.classList.remove("off"),alone.classList.add("off")}};var APP=APP||{};APP.Geolocation={_latitude:null,_longitude:null,setUp:function(){var that=this;that.getLocation()},getLocation:function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(APP.Geolocation.saveLocation,APP.Geolocation.showError):console.log("Geolocalização não é suportada!")},saveLocation:function(dataPosition){APP.Geolocation._latitude=dataPosition.coords.latitude,APP.Geolocation._longitude=dataPosition.coords.longitude,null!==APP.Geolocation._latitude&&null!==APP.Geolocation._longitude?APP.Geolocation.Home.Map.createMap():APP.Geolocation.getLocation()},showError:function(error){console.log(error)}};var APP=APP||{},Geolocation=APP||{};APP.Geolocation.Home={_objResponse:null,setUp:function(){},Map:{_map:null,setUp:function(){},createMap:function(){var that=this,latitude=APP.Geolocation._latitude,longitude=APP.Geolocation._longitude,myLatlng=new google.maps.LatLng(latitude,longitude),mapOptions={zoom:12,center:myLatlng,panControl:!1,mapTypeControl:!0,zoomControl:!0,streetViewControl:!1,mapTypeControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.LEFT_BOTTOM},mapTypeId:google.maps.MapTypeId.ROADMAP,styles:[{stylers:[{saturation:-70}]}]},image="http://google-maps-icons.googlecode.com/files/cycling.png".marker;that._map=new google.maps.Map(document.getElementById("map"),mapOptions),image="src/images/user.png",marker=new google.maps.Marker({position:myLatlng,map:that._map,icon:image});({content:"<h1>Você está aqui!</h1>",disableAutoPan:!1,maxWidth:0,pixelOffset:new google.maps.Size(-85,0),zIndex:null,boxStyle:{marginTop:"10px",width:"170px"},closeBoxMargin:"0 2px 2px 2px",closeBoxURL:"http://www.google.com/intl/en_us/mapfiles/close.gif",infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatPane",enableEventPropagation:!1});null!==that._map&&null===that.pai()._objResponse&&that.pai().Cycle.makeCycleway()}},Cycle:{makeCycleway:function(){var that=this,path="json.php",params={latitude:APP.Geolocation._latitude,longitude:APP.Geolocation._longitude},request=$.when(APP.Request.makeRequest(path,params));request.done(function(response){var c,countCoordinates,colors=["#FF0000","#015d01","#0000FF","#e85d00"];that.pai()._objResponse=response,$.each(that.pai()._objResponse.cicloways,function(idx,value){var DrivePath=[],coordinates=value.geometry;for(c=0,countCoordinates=coordinates.length;countCoordinates>c;c+=1){var coordinate=coordinates[c],latitude=coordinate[1],longitude=coordinate[0];DrivePath.push(new google.maps.LatLng(latitude,longitude))}var PathStyle=new google.maps.Polyline({path:DrivePath,strokeColor:"",strokeOpacity:1,strokeWeight:3,map:that.pai().Map._map,id:value.id});switch(value.type){case"Ciclovia":PathStyle.strokeColor=colors[0];break;case"Ciclofaixa Móvel":PathStyle.strokeColor=colors[1];break;case"Ciclofaixa":PathStyle.strokeColor=colors[2];break;case"Rota":PathStyle.strokeColor=colors[3]}if(PathStyle.setMap(that.pai().Map._map),DrivePath.length%2==0){console.log("O value.id é: "+value.name);var customMarker=new google.maps.Marker({position:new google.maps.LatLng(DrivePath[DrivePath.length/2].k,DrivePath[DrivePath.length/2].B),map:that.pai().Map._map,id:value.id,icon:"src/images/icones/icon-pracas.png"})}else var customMarker=new google.maps.Marker({position:new google.maps.LatLng(DrivePath[(DrivePath.length+1)/2].k,DrivePath[(DrivePath.length+1)/2].B),map:that.pai().Map._map,id:value.id,icon:"src/images/icones/icon-ciclovias.png"});var markerSelected,boxText='<h1 class="title-info">'+value.name+'</h1><h2 class="distance-info">'+value.distance+' km de distância</h2><a class="link-info">Pedalar até aqui</a>',myOptions={content:boxText,disableAutoPan:!1,maxWidth:0,pixelOffset:new google.maps.Size(-140,0),zIndex:null,boxStyle:{marginTop:"13px",width:"280px"},closeBoxMargin:"0 2px 2px 2px",closeBoxURL:"http://www.google.com/intl/en_us/mapfiles/close.gif",infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatPane",enableEventPropagation:!1},infobox=new InfoBox(myOptions);google.maps.event.addListener(customMarker,"click",function(customMarker){return function(){infobox.open(that.pai().Map._map,customMarker),markerSelected=customMarker}}(customMarker)),google.maps.event.addListener(infobox,"domready",function(){$(".infoBox").on("click",".link-info",function(event){var rendererOptions=(event.currentTarget,{draggable:!0}),directionsService=new google.maps.DirectionsService,directionsDisplay=new google.maps.DirectionsRenderer(rendererOptions);directionsDisplay.setMap(that.pai().Map._map);var start=new google.maps.LatLng(APP.Geolocation._latitude,APP.Geolocation._longitude),end=new google.maps.LatLng(markerSelected.position.k,markerSelected.position.B),request={origin:start,destination:end,travelMode:google.maps.TravelMode.DRIVING};directionsService.route(request,function(response,status){status==google.maps.DirectionsStatus.OK&&(console.log(response),directionsDisplay.setDirections(response))}),event.preventDefault()})})})})}}};var APP=APP||{};APP.Request={makeRequest:function(url,params){return $.ajax({url:url,dataType:"json",data:params,beforeSend:function(){console.log("Carregando...")},complete:function(){console.log("Carregou!")}})}};var APP=APP||{},Geolocation=APP||{};APP.Geolocation.Home.List={setUp:function(){var that=this,bodyHeight=$("body").height();$(".main-section").css("height",bodyHeight-80),$(".canvas-list").on("click",function(event){var element=$(event.currentTarget),id=element.attr("id");$(".main-section").empty(),null!==that.pai()._objResponse?that.makeList(APP.Geolocation.Home._objResponse,id):console.log("Aguarde! Estamos carregando os dados!!!")})},makeList:function(obj,typeId){var ul=$("<ul>").appendTo("#main-section"),fragment=document.createDocumentFragment();"alone"===typeId?$.each(obj.cicloways,function(idx,item){var li=$("<li>"),h5=$("<h5>"),distance=$("<p>");type=$("<p>"),h5.text(item.name).appendTo(li),distance.text(item.distance).appendTo(li),type.text(item.type).appendTo(li),$(fragment).append(li)}):$.each(obj.groups,function(idx,item){var li=$("<li>"),h5=$("<h5>"),h4=$("<h4>"),distance=$("<p>"),level=$("<p>"),schedule=$("<p>");h5.text(item.name).appendTo(li),h4.text("Informações: "+item.information).appendTo(li),distance.text("Distância: "+item.distance+"km").appendTo(li),level.text("Nível: "+item.level).appendTo(li),schedule.text("Data do evento: "+item.schedule).appendTo(li),$(fragment).append(li)}),ul.append(fragment)}};